description: Maybee

environment:
  image: frostofwinter/py37maybee:new
  registry: docker.io # any public registry can be specified here

target:
  service: singularity
  name: msrresrchvc    
  # name: msroctovc   
  # name: msrrlvc
  # # vc: resrchvc
  #   TARGET NAME    RESOURCE GROUP          ACCELERATOR    QUOTAS (USED/LIMIT)
  # -------------  ----------------------  -------------  --------------------------------------------------
  #                                                       Premium        Standard    Basic        User max
  # msroctovc      gcr-singularity-octo    V100    16GB    1162 /  1920    .      .   24 / 69960  . /   64
  # msrresrchvc    gcr-singularity-resrch  CPU   8/10GB   17084 / 17600    0 / 6400    0 /  6400  . / 2048
  # msrresrchvc    gcr-singularity-resrch  A100    80GB     326 /   340   87 /  340   51 /   680  . /   32
  # msrresrchvc    gcr-singularity-resrch  V100    16GB     581 /   648    .      .    8 /   648  . /   64
  # msrrlvc        gcr-singularity-rl      T4      16GB      73 /   596    0 /  596    0 /   596  .      .
code:
  local_dir: $CONFIG_DIR  

# data:
#   data upload is not required for this example

search:
  job_template:
    # you may use {random_string:s} to avoid job name collisions
    # {auto:3s} generates lr_0.00000_mom_0.5, .. etc
    # {auto:2s} generates lr_0.00000_mo_0.5, .. etc
    name: search_{auto:3s}
    sku: 16G1-V100
    command:
    - python train_rl_aml.py config/onlineRLamlt.yaml --runtime.output_dir $$AMLT_OUTPUT_DIR --algorithm dsac --use_avg_q {avq} --grad_step_num_v_per_epoch {gnv} --entropy_penalty_beta {epb} --random_mps_change {mps} --action_mask_mode {amm} 
    # - python train_rl_aml.py config/onlineRLamlt.yaml --algorithm grape --alpha_grape {alp} --lambd_grape {lmd} --coef_entropy {coe} --random_mps_change {mps}

    submit_args: &retry_args
      max_attempts: 2
      max_run_duration_seconds: 600000  # 7 days
    
  type: grid
  sampling: grid
  max_trials: 512
  parallel_trials: 512

  params: 
    - name: mps
      spec: discrete
      values: [0, 1]
    
    - name: amm
      spec: discrete
      values: [1, 2]

    - name: epb
      spec: discrete
      values: [0.01, 0.05, 0.2, 0.5, 4]

    - name: gnv
      spec: discrete
      values: [1000, 5000, 20000]

    - name: avq
      spec: discrete
      values: [0]
    
    # - name: alp
    #   spec: discrete
    #   values: [0, 0.5, 0.95, 0.99]

    # - name: lmd
    #   spec: discrete
    #   values: [0.0, 0.7]

    # - name: coe
    #   spec: discrete
    #   values: [0.001, 0.01, 0.1, 1]